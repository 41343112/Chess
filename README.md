# 國際象棋遊戲

使用 Qt/C++ 開發的完整國際象棋遊戲，具有圖形化使用者介面，類似 Chess.com。

## 🎉 新功能
- **語言選擇**：支援中文和英文介面切換！⭐ 最新功能
- **恢復預設值**：一鍵重置所有設定到預設值！⭐ 最新功能
- **翻轉棋盤按鈕**：切換棋盤方向，從任一玩家視角查看！⭐ 新功能
- **完整音效系統**：包含移動音效、吃子音效、攻擊國王音效（將軍）、將殺音效 ⭐ 新功能
- **拖放移動**：用滑鼠拖曳棋子進行移動！
- **將軍高亮顯示**：王被攻擊時方格變紅色
- **增強的視覺回饋**：所有遊戲狀態都有清晰的視覺指示
- **保持方格網格**：調整視窗大小時棋盤保持完美的正方形

詳細的新功能文件請參閱 [NEW_FEATURES.md](docs/NEW_FEATURES.md) 和 [FEATURE_SUMMARY.md](docs/FEATURE_SUMMARY.md)。

**最新設定功能文件**：
- [SETTINGS_NEW_FEATURES.md](SETTINGS_NEW_FEATURES.md) - 語言選擇和恢復預設值功能說明
- [VISUAL_GUIDE_NEW_FEATURES.md](VISUAL_GUIDE_NEW_FEATURES.md) - 新功能視覺化使用指南
- [LANGUAGE_FEATURE_SUMMARY.md](LANGUAGE_FEATURE_SUMMARY.md) - 語言功能技術摘要

## 📚 文件說明
- **[GAMEPLAY.md](docs/GAMEPLAY.md)** - 完整的遊戲指南，包含規則、操作和策略
- [NEW_FEATURES.md](docs/NEW_FEATURES.md) - 最新功能新增和實作細節
- [UI_MOCKUP.md](docs/UI_MOCKUP.md) - 使用者介面設計和模型
- **[SETTINGS_NEW_FEATURES.md](SETTINGS_NEW_FEATURES.md)** - 設定對話框新功能 ⭐ 最新

## 目錄
- [中文玩法說明](#中文玩法說明) ⭐ 中文遊戲說明
- [功能特色](#功能特色)
- [架構](#架構)
- [入門指南](#入門指南)
  - [系統需求](#系統需求)
  - [建置與執行](#建置與執行)
  - [疑難排解](#疑難排解)
- [如何遊玩](#如何遊玩)
- [遊戲狀態訊息](#遊戲狀態訊息)
- [技術實作細節](#技術實作細節)
- [未來改進](#未來改進)

## 中文玩法說明

### 遊戲簡介
這是一個完整的國際象棋遊戲，使用 Qt/C++ 開發，具有類似 Chess.com 的圖形化使用者介面。

### 如何開始遊戲
1. **啟動遊戲**
   - 白方先行
   - 遊戲開始時，所有棋子按照標準國際象棋規則擺放

2. **操作棋子 - 兩種方式**
   - **點擊移動**：點選棋子選擇它，再點選目標位置完成移動
   - **拖曳移動**：按住棋子拖曳到目標位置，放開滑鼠完成移動 ⭐
   - 兩種方式可以混合使用！

3. **視覺提示**
   - **金色高亮**：已選中的棋子
   - **藍色邊框**：可移動的空位
   - **紅色邊框**：可吃掉對方棋子的位置
   - **紅色底色**：王被將軍（處於被攻擊狀態）
   - 只能移動輪到自己的棋子
   - 遊戲會自動防止不合法的移動

### 棋子走法
- **兵（♙/♟）**：向前走一格，第一步可走兩格，斜向吃子
- **車（♖/♜）**：橫向或縱向直線移動
- **馬（♘/♞）**：L型移動（日字形）
- **象（♗/♝）**：斜向直線移動
- **后（♕/♛）**：橫向、縱向或斜向直線移動（車+象的組合）
- **王（♔/♚）**：任意方向移動一格

### 特殊走法
- **王車易位**：點選國王，然後點選向車移動兩格的位置（或拖曳）
  - 條件：國王和車都未移動過，中間無棋子，國王不在被將軍狀態
- **吃過路兵**：當對方兵首步走兩格後，可在下一回合用自己的兵斜向吃掉它
- **兵升變**：兵到達對方底線時自動升變為后

### 遊戲結束條件
- **將死**：對方國王被將軍且無法逃脫 → 獲勝
- **逼和**：輪到己方但沒有合法走法且王未被將軍 → 平局

### 遊戲狀態訊息
- "Game in progress" - 遊戲進行中
- "White is in check!" / "Black is in check!" - 白方/黑方被將軍
- "White wins by checkmate!" / "Black wins by checkmate!" - 白方/黑方獲勝
- "Stalemate - Draw!" - 逼和平局

### 控制按鈕
- **New Game**：開始新遊戲
- **Undo**：悔棋，撤銷上一步移動 ⭐ 完整功能
- **Flip Board**：翻轉棋盤，從另一方視角查看
- **Settings**：開啟設定對話框 ⭐ 含新功能
  - 語言選擇（中文/English）
  - 恢復預設值按鈕
  - 顏色自訂
  - 音量控制
  - 時間限制設定

### 遊戲提示
1. 先觀察棋盤，思考對手的威脅
2. 確保你的國王安全
3. 控制棋盤中心區域
4. 發展你的棋子（尤其是馬和象）
5. 保護好你的后，它是最強大的棋子
6. 嘗試創造攻擊對方國王的機會

## 功能特色

### 完整的國際象棋規則實作
- ✅ 所有棋子移動（兵、車、馬、象、后、王）
- ✅ 特殊走法：
  - 王車易位（王翼和后翼）
  - 吃過路兵
  - 兵升變為后
- ✅ 將軍偵測
- ✅ 將死偵測
- ✅ 逼和偵測
- ✅ 移動驗證（防止非法移動）
- ✅ 回合制遊戲（白方/黑方輪流）

### 使用者介面
- ✅ 8x8 棋盤，淺色和深色方格交替
- ✅ Unicode 國際象棋符號（♔ ♕ ♖ ♗ ♘ ♙）
- ✅ 視覺回饋：
  - 選中棋子高亮顯示（金色）
  - 有效移動高亮顯示（綠色）
  - **王被將軍高亮顯示（紅色）** ⭐ 新功能
  - 回合指示器
  - 遊戲狀態顯示
- ✅ 點擊選擇、點擊移動介面
- ✅ **拖放移動棋子** ⭐ 新功能
- ✅ **翻轉棋盤按鈕** - 從任一玩家視角查看 ⭐ 新功能
- ✅ **完整音效系統** - 移動音效、吃子音效、攻擊國王音效（將軍）、將殺音效 ⭐ 新功能
- ✅ **完整悔棋功能** - 支援所有類型走法的撤銷（包括王車易位、吃過路兵、兵升變） ⭐ 新功能
- ✅ 新遊戲按鈕
- ✅ 遊戲結束對話框

## 架構

### 類別結構

**ChessPiece（抽象基底類別）**
- 所有棋子的基底類別
- 定義共同屬性：類型、顏色、位置、移動狀態
- 純虛擬方法 `isValidMove()` 用於特定棋子的移動驗證

**棋子子類別**
- `Pawn`（兵） - 向前移動、斜向吃子、吃過路兵、升變
- `Rook`（車） - 水平和垂直移動
- `Knight`（馬） - L 形移動
- `Bishop`（象） - 對角線移動
- `Queen`（后） - 結合車和象的移動
- `King`（王） - 任意方向移動一格、王車易位

**ChessBoard**
- 管理 8x8 棋盤狀態
- 處理移動執行和驗證
- 追蹤遊戲狀態（回合、將軍、將死、逼和）
- 維護移動歷史
- 實作特殊移動邏輯（王車易位、吃過路兵）

**myChess（主視窗）**
- 基於 Qt 的圖形介面
- ChessSquare 按鈕用於棋盤互動
- 遊戲控制（新遊戲、悔棋）
- 狀態和回合顯示

**ChessSquare**
- 每個棋盤方格的自訂 QPushButton
- 視覺狀態：正常、選中、高亮
- 顯示棋子符號

## 入門指南

### 快速入門指南

**對於有經驗的 Qt 開發者：**
```bash
git clone https://github.com/41343112/Chess.git
cd Chess
qmake Chess.pro
make
./Chess
```

**對於初學者：** 請遵循以下詳細說明。

### 系統需求

在建置國際象棋遊戲之前，您需要安裝以下軟體：

#### 1. Qt 框架（Qt 5.12+ 或 Qt 6.x）

**Linux（Ubuntu/Debian）：**
```bash
# 對於 Qt 5
sudo apt-get update
sudo apt-get install qt5-default qtbase5-dev qttools5-dev-tools

# 對於 Qt 6
sudo apt-get update
sudo apt-get install qt6-base-dev qt6-tools-dev
```

**macOS：**
```bash
# 使用 Homebrew
brew install qt@5
# 或
brew install qt@6

# 將 Qt 加入 PATH（加入到 ~/.zshrc 或 ~/.bash_profile）
export PATH="/opt/homebrew/opt/qt@5/bin:$PATH"  # 對於 Qt 5
# 或
export PATH="/opt/homebrew/opt/qt@6/bin:$PATH"  # 對於 Qt 6
```

**Windows：**
1. 從 [qt.io/download](https://www.qt.io/download-qt-installer) 下載 Qt 線上安裝程式
2. 執行安裝程式並選擇：
   - Qt 5.15.x 或 Qt 6.x
   - MinGW 編譯器（或如果您有 Visual Studio，則選擇 MSVC）
   - Qt Creator IDE
3. 完成安裝

#### 2. C++ 編譯器

**Linux：**
```bash
# GCC（通常已預先安裝）
sudo apt-get install build-essential
g++ --version  # 驗證安裝
```

**macOS：**
```bash
# Xcode 命令列工具
xcode-select --install
```

**Windows：**
- MinGW 隨 Qt 安裝程式附帶，或
- 安裝 Visual Studio 2019/2022 並包含 C++ 工作負載

#### 3. 驗證安裝

檢查 Qt 工具是否可用：
```bash
qmake --version
```

預期輸出應顯示 Qt 版本 5.x 或 6.x。

### 建置與執行

#### 方法 1：命令列（快速入門）

**步驟 1：複製或下載儲存庫**
```bash
# 如果使用 git
git clone https://github.com/41343112/Chess.git
cd Chess

# 或下載並解壓縮 ZIP，然後導航到目錄
```

**步驟 2：建置專案**
```bash
# 產生 Makefile
qmake Chess.pro

# 編譯專案
make

# 在 Windows 使用 MinGW 時，使用：
# mingw32-make
```

**步驟 3：執行應用程式**
```bash
# Linux/macOS
./Chess

# Windows
Chess.exe
# 或在建置目錄中雙擊 Chess.exe
```

#### 方法 2：Qt Creator（推薦初學者使用）

**步驟 1：開啟專案**
1. 啟動 Qt Creator
2. 點擊「檔案」→「開啟檔案或專案」
3. 導航到 Chess 目錄
4. 選擇 `Chess.pro` 並點擊「開啟」

**步驟 2：配置專案**
1. Qt Creator 會顯示「配置專案」畫面
2. 選擇一個 Qt 套件（例如「Desktop Qt 5.15.2 MinGW 64-bit」）
3. 點擊「配置專案」

**步驟 3：建置和執行**
1. 點擊左下角的綠色「執行」按鈕（▶），或
2. 按 `Ctrl+R`（Windows/Linux）或 `Cmd+R`（macOS）
3. 國際象棋遊戲視窗將會出現

### 疑難排解

**問題：「qmake: command not found」**
- 解決方案：確保 Qt bin 目錄在您的 PATH 中
- Linux/macOS：將 Qt 路徑加入 ~/.bashrc 或 ~/.zshrc
- Windows：將 Qt bin 目錄加入系統環境變數

**問題：「Project ERROR: Unknown module(s) in QT: widgets」**
- 解決方案：安裝 Qt widgets 模組：
  ```bash
  # Linux
  sudo apt-get install qtbase5-dev
  ```

**問題：建置失敗並出現 C++17 錯誤**
- 解決方案：確保您的編譯器支援 C++17
- 將 GCC 更新到版本 7+ 或使用 Clang 5+

**問題：應用程式在 Windows 上無法啟動**
- 解決方案：將 Qt DLL 複製到可執行檔目錄：
  ```bash
  # 導航到 Qt bin 目錄並複製所需的 DLL
  # 對於 MinGW Qt 5.15：
  Qt5Core.dll、Qt5Gui.dll、Qt5Widgets.dll
  # 加上平台外掛：platforms/qwindows.dll
  ```
  或從 Qt Creator 執行，它會自動處理這個問題。

**問題：黑色畫面或介面問題**
- 解決方案：更新顯示卡驅動程式
- 嘗試使用軟體渲染執行：`export QT_QPA_PLATFORM=offscreen`

### 您將看到什麼

一旦應用程式執行，您將看到：

**遊戲棋盤：**
- 8×8 棋盤，淺色（米色 #F0D9B5）和深色（棕色 #B58863）方格交替
- Unicode 國際象棋符號：♔ ♕ ♖ ♗ ♘ ♙（白色）和 ♚ ♛ ♜ ♝ ♞ ♟（黑色）
- 清爽、專業的外觀，類似 Chess.com

**互動元素：**
- 點擊任意棋子選擇它（以金色高亮顯示）
- 有效移動以淺綠色高亮顯示
- 回合指示器顯示「回合：白方」或「回合：黑方」
- 狀態列顯示遊戲狀態（將軍、將死、逼和）
- 「新遊戲」按鈕重新開始
- 「悔棋」按鈕（未來功能的占位符）

**範例遊戲狀態：**
```
標準國際象棋初始位置：
第 8 列：♜ ♞ ♝ ♛ ♚ ♝ ♞ ♜
第 7 列：♟ ♟ ♟ ♟ ♟ ♟ ♟ ♟
第 6-3 列：空方格
第 2 列：♙ ♙ ♙ ♙ ♙ ♙ ♙ ♙
第 1 列：♖ ♘ ♗ ♕ ♔ ♗ ♘ ♖
```

詳細的介面設計模型請參閱 [UI_MOCKUP.md](docs/UI_MOCKUP.md)。

## 如何遊玩

**完整的遊戲指南，包含詳細規則、策略和技巧，請參閱 [GAMEPLAY.md](docs/GAMEPLAY.md)。**

### 快速入門

1. **開始遊戲**
   - 白方先行
   - 點擊選擇棋子或開始拖曳棋子
   - 有效移動將以綠色高亮顯示
   - 點擊高亮的方格或拖放來移動棋子

2. **移動方式 - 兩種方法：**
   - **點擊移動**：點擊棋子選擇它，然後點擊目標方格
   - **拖放移動**：點擊並按住棋子，拖曳到目標位置，然後放開 ⭐ 新功能
   - 兩種方法可以無縫配合使用！

3. **視覺指示**
   - **金色高亮**：選中的棋子
   - **綠色高亮**：有效的移動目標
   - **紅色高亮**：王被將軍 ⭐ 新功能
   - 只能移動當前玩家的棋子
   - 遊戲會防止會讓自己的王被將軍的非法移動
   - **完整音效回饋**：移動、吃子、將軍、將殺時會聽到不同的聲音 ⭐ 新功能

4. **特殊移動**
   - **王車易位**：點擊您的王，然後點擊向車移動兩格的位置（或拖曳）
   - **吃過路兵**：當對手的兵向前移動兩格時可以使用
   - **兵升變**：兵到達對面底線時自動升變為后

5. **獲勝**
   - 將死：對手的王被將軍且沒有合法移動
   - 逼和：當前玩家沒有合法移動但未被將軍（平局）

6. **遊戲控制**
   - **新遊戲**：開始新的遊戲
   - **悔棋**：撤銷上一步移動，支援所有類型的走法（包括王車易位、吃過路兵、兵升變） ⭐ 完整功能
   - **翻轉棋盤**：將棋盤旋轉 180° 以從另一位玩家的視角查看 ⭐ 新功能

## 遊戲狀態訊息

- "Game in progress" - 正常進行中
- "White is in check!" / "Black is in check!" - 白方/黑方被將軍
- "White wins by checkmate!" / "Black wins by checkmate!" - 白方/黑方獲勝
- "Stalemate - Draw!" - 逼和平局

## 技術實作細節

### 移動驗證
- 兩階段驗證：
  1. 棋子特定規則（每個棋子類別）
  2. 棋盤層級檢查（不會讓自己的王被將軍）

### 將軍偵測
- 掃描所有對手棋子，檢查是否能攻擊王
- 防止會讓自己的王被將軍的移動

### 將死偵測
- 王被將軍
- 沒有合法移動可以逃脫將軍

### 逼和偵測
- 王未被將軍
- 沒有可用的合法移動

## 未來改進

未來版本可能的新增功能：
- ✅ ~~完整的悔棋/重做功能~~ **已完成！**
- 重做功能（Redo）
- 使用代數記譜法的移動歷史顯示
- 計時遊戲的計時器/時鐘
- 儲存/載入遊戲狀態
- 棋子升變選擇對話框（目前自動升變為后）
- 音效音量控制
- 額外的音效（將軍、將死、王車易位）
- 音效開關切換
- 動畫棋盤翻轉過渡效果
- 開局庫和遊戲分析
- 線上多人對戰
- AI 對手

## 授權

本專案為開源專案，可用於教育目的。
